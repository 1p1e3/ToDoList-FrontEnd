<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDoListğŸ“Œ</title>
    <!-- å¼•å…¥ Vue2 -->
    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>
    <!-- å¼•å…¥ element-ui -->
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <!-- å¼•å…¥ axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <!-- vue app æ ¹ç›’å­ -->
    <div id="app">
        <h1 class="title">ToDoList</h1>
        <!-- 1. æ·»åŠ è®¡åˆ’ -->
        <div class="adddiv">
            <h3>æ·»åŠ </h3>
            <div style="margin-top: 15px;">
                <!-- æ·»åŠ è®¡åˆ’è¾“å…¥æ¡† + æäº¤æŒ‰é’®ï¼Œç»‘å®š add æ–¹æ³• -->
                <el-input placeholder="å¼€å¯ä¸€ä¸ªè®¡åˆ’å§ï¼â±ï¸" v-model="todo">
                    <el-button
                    slot="append"
                    style="background-color: #409eff;color: #fff;"
                    icon="el-icon-plus"
                    @click="add">
                </el-button>
                </el-input>
            </div>
        </div>

        <!-- åˆ†éš”çº¿ -->
        <el-divider></el-divider>

        <!-- 2. è®¡åˆ’åˆ—è¡¨ -->
        <div class="list">
            <!-- 
                å±•ç¤ºå¾…å®Œæˆå’Œå·²å®Œæˆè®¡åˆ’æ•°é‡ï¼š
                finishedNumï¼šå·²å®Œæˆæ•°é‡
                createdNumï¼šå¾…å®Œæˆæ•°é‡
            -->
            <div style="display: flex; align-items: center;">
                <h3>è®¡åˆ’åˆ—è¡¨</h3>
                <el-tag type="success" style="margin-left: 20px;">å·²å®Œæˆ: {{finishedNum}}</el-tag>
                <el-tag type="danger" style="margin-left: 10px;">å¾…å®Œæˆ: {{createdNum}}</el-tag>
            </div>
            <!-- å±•ç¤ºæ€»å…±çš„è®¡åˆ’ï¼Œä¸åŒ…æ‹¬å·²åˆ é™¤çš„ -->
            <el-table :data="todolist" height="350" style="width: 100%">
                <el-table-column prop="ID" label="ID"></el-table-column>
                <el-table-column prop="Name" label="äº‹é¡¹"></el-table-column>
                <el-table-column label="çŠ¶æ€">
                    <!-- 
                        åˆ¤æ–­ Status çš„å€¼ï¼š
                        Status = 1ï¼Œåˆ™æ˜¾ç¤ºå¾…å®Œæˆæ ‡ç­¾ï¼›
                        Status = 2ï¼Œåˆ™æ˜¾ç¤ºå·²å®Œæˆæ ‡ç­¾ã€‚
                    -->
                    <template slot-scope="scope">
                        <el-tag type="danger" v-if="scope.row.Status === 1">å¾…å®Œæˆ</el-tag>
                        <el-tag type="success" v-if="scope.row.Status === 2">å·²å®Œæˆ</el-tag>
                    </template>
                </el-table-column>
                <!-- 
                    å¾…å®Œæˆçš„è®¡åˆ’å±•ç¤ºå®Œæˆå’Œåˆ é™¤æŒ‰é’®ï¼Œå·²å®Œæˆçš„è®¡åˆ’ä»…å±•ç¤ºï¼Œæ²¡æœ‰ä»»ä½•æ“ä½œã€‚
                    å’Œä¸Šé¢çš„çŠ¶æ€æ ‡ç­¾ä¸€æ ·ï¼Œéƒ½æ˜¯é€šè¿‡ v-if å»åˆ¤æ–­ Status çš„å€¼ï¼Œæ¥æ§åˆ¶æŒ‰é’®çš„ç°å®å’Œéšè—
                -->
                <el-table-column label="æ“ä½œ">
                    <template slot-scope="scope">
                        <el-button
                        size="mini"
                        type="primary"
                        v-if="scope.row.Status == 1"
                        @click="finish(scope.$index, scope.row)">å®Œæˆ</el-button>
                        <el-button
                        size="mini"
                        type="danger"
                        v-if="scope.row.Status == 1"
                        @click="del(scope.$index, scope.row)">åˆ é™¤</el-button>
                    </template>
                </el-table-column>
            </el-table>
        </div>  
    </div>
</body>
</html>
<style>
    /* æ ¹ç›’å­å±…ä¸­ */
    #app{
        width: 60%;
        margin: 0 auto;
    }
    .title {
        font-weight: bold;
    }
    .adddiv {
        width: 500px;
    }
</style>
<script>
    // åˆ›å»º vue å®ä¾‹
    var app = new Vue({
    el: '#app',
    data: {
        todo: '',  // è®¡åˆ’
        todolist: [], // è®¡åˆ’åˆ—è¡¨æ•°æ®
        finishedNum: 0, // å®Œæˆè®¡åˆ’æ•°
        createdNum: 0 // å¾…å®Œæˆè®¡åˆ’æ•°
    },
    methods: {
        // æ·»åŠ è®¡åˆ’
        add() {
            // å¦‚æœ todo å±æ€§ä¸ºç©ºï¼Œåˆ™è¡¨ç¤ºç”¨æˆ·å¹¶æ²¡æœ‰è¾“å…¥å°±ç‚¹å‡»äº† + æŒ‰é’®
            // æ­¤æ—¶éœ€è¦æç¤ºç”¨æˆ·
            if (this.todo == '') {
                this.$message.error('äº‹é¡¹ä¸èƒ½ä¸ºç©ºï¼ğŸ˜“');
            } else {
                axios({
                method: 'post',
                url: 'http://127.0.0.1:8080/todo',
                data: {
                    name: this.todo
                }
                })
                this.$message({
                message: 'æ·»åŠ æˆåŠŸï¼ğŸ˜‰',
                type: 'success'
                })
                // 1s ä¹‹åé‡æ–°åŠ è½½é¡µé¢ï¼Œç›®çš„æ˜¯é‡æ–°è¯·æ±‚ä¸€æ¬¡ï¼Œè·å¾—æ–°æ·»åŠ çš„è®¡åˆ’
                setTimeout(() => {
                    window.location.reload()
                }, 1000)
            }
        },
        // å®Œæˆè®¡åˆ’ï¼Œç»™æ¥å£ä¼ è®¡åˆ’çš„ id
        finish(index, row) {
            let that = this
            axios({
                method: 'post',
                url: 'http://127.0.0.1:8080/finish',
                data: {
                    id: row.ID
                }
            })
            this.$message({
                message: 'å¤ªæ£’äº†ï¼ğŸ‰',
                type: 'success'
            })
            setTimeout(() => {
                window.location.reload()
            }, 1000)
        },
        // åˆ é™¤è®¡åˆ’ï¼ŒåŒæ ·ä¹Ÿæ˜¯ç»™æ¥å£ä¼ è®¡åˆ’ id
        del(index, row) {
            let that = this
            axios({
                method: 'post',
                url: 'http://127.0.0.1:8080/delete',
                data: {
                    id: row.ID
                }
            })
            this.$message({
                message: 'è¿™ä»¶äº‹æ¨è¿Ÿäº†å—ï¼ŸğŸ¤”',
                type: 'success'
            })
            setTimeout(() => {
                window.location.reload()
            }, 1000)
        }
    },
    // åœ¨ç»„ä»¶æŒ‚åœ¨å®Œæˆä¹‹åç»™è·å–è®¡åˆ’åˆ—è¡¨æ¥å£å‘é€è¯·æ±‚
    // mounted() æ–¹æ³•æ¯æ¬¡åˆ·æ–°é¡µé¢éƒ½ä¼šæŒ‡å‘
    // ä½¿ç”¨ mounted() æ–¹æ³•ç›®çš„æ˜¯ä¸ºäº†åœ¨æ¯æ¬¡åˆ·æ–°é¡µé¢çš„æ—¶å€™éƒ½å»è·å–æœ€æ–°çš„æ•°æ®
    mounted() {
        let that = this
        axios({
            method: 'get',
            url: 'http://127.0.0.1:8080/todo',
            }).then(function (response) {
                that.todolist = response.data.data
                that.todolist.reverse() // åè½¬ todolistï¼Œè®©æ–°æ·»åŠ çš„è®¡åˆ’åœ¨åˆ—è¡¨çš„å¤´éƒ¨æ˜¾ç¤º
                // for å¾ªç¯ç»Ÿè®¡å¾…å®Œæˆå’Œå·²å®Œæˆçš„è®¡åˆ’æ•°é‡
                for (let i = 0; i < that.todolist.length; i++) {
                    if (that.todolist[i].Status === 1) {
                        that.createdNum++
                    } else {
                        that.finishedNum++
                    }
                }
            })
        }
    })
</script>